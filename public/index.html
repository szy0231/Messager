<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>消息解锁 - 邵子越</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css?v=7">
</head>
<body>
  <div class="app-container" id="main-container">
    
    <!-- Name Input Step -->
    <div id="name-step" class="step-container hidden">
      <div class="centered-card">
        <div style="margin-bottom: 12px; opacity: 0.6;">
          <span style="font-size: 48px;">👋</span>
        </div>
        <div class="intro-text">
          <p style="margin-bottom: 10px;">嗨，朋友：</p>
          <p style="margin-bottom: 10px;">我一直觉得人与人的连接是世上最宝贵的事物。于是，这个随便捣鼓的小东西应运而生。</p>
          <p style="margin-bottom: 10px;">这是一个交换夸赞的平台，旨在通过交换简单的赞美留言，升华春节间朋友圈的真善美。</p>
          <p style="margin-bottom: 10px;">机制很简单：在一方上传文字后，直到另一方上传留言之前，这段文字无法被ta看见。只有在双方都留言后，互相的文字才会解锁。</p>
          <p style="margin-bottom: 0;">让我们用几行字的温暖作酒杯，祝你我在下一年都会 做大做强！</p>
        </div>
        <h1 class="step-title" id="name-title">请大声告诉我你是谁！</h1>
        <p style="color: var(--text-light); font-size: 14px; margin-top: -8px; margin-bottom: 24px;">第一步 · 身份确认</p>
        <form id="name-form" class="clean-form" autocomplete="off">
          <div class="form-row">
            <input type="text" id="family-name" placeholder="姓" required autofocus autocomplete="off">
            <input type="text" id="given-name" placeholder="名" required autocomplete="off">
          </div>
          <button type="submit" class="btn btn-primary btn-large" id="submit-name-btn">继续 →</button>
        </form>
        <p class="change-name-link">
          <button id="change-name-btn" class="link-button hidden">更改姓名</button>
        </p>
      </div>
    </div>

    <!-- PIN Input Step (for existing users) -->
    <div id="pin-input-step" class="step-container hidden">
      <div class="centered-card">
        <div style="width: 60px; height: 60px; margin: 0 auto 20px; background: linear-gradient(135deg, var(--primary-light), var(--primary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px;">
          🔐
        </div>
        <h1 class="step-title">输入您的密码</h1>
        <p class="step-subtitle">欢迎回来，<span id="pin-user-name"></span>！</p>
        <p style="color: var(--text-light); font-size: 13px; margin-top: -24px; margin-bottom: 24px;">第二步 · 安全验证</p>
        <form id="pin-form" class="clean-form">
          <input type="text" id="pin-input" placeholder="••••" maxlength="4" pattern="\d{4}" required autofocus>
          <button type="submit" class="btn btn-primary btn-large">登录 →</button>
        </form>
        <p class="help-text">忘记密码？联系传说中的邵子越寻求帮助。</p>
        <button id="back-to-name-btn" class="link-button">← 更改姓名</button>
      </div>
    </div>

    <!-- PIN Display Step (for new users) -->
    <div id="pin-display-step" class="step-container hidden">
      <div class="centered-card pin-card-highlight">
        <div style="font-size: 56px; margin-bottom: 16px; animation: bounce 1s ease;">🎉</div>
        <h1 class="step-title">欢迎！</h1>
        <p class="step-subtitle">Oh亲爱的朋友，您的账户已创建。</p>
        <p style="color: var(--text-light); font-size: 13px; margin-top: -20px; margin-bottom: 32px;">第二步 · 密码生成</p>
        <div class="pin-display-box">
          <p class="pin-label">⚠️ 您的密码是：</p>
          <h2 class="pin-number" id="displayed-pin">0000</h2>
          <p class="pin-warning">记不住没关系！</p>
          <p class="pin-help">每次登录都需要此密码。<br>
          如果忘记，只有<strong>邵子越</strong>可以帮您找回。</p>
        </div>
        <button id="pin-understood-btn" class="btn btn-primary btn-large">我已保存密码 →</button>
      </div>
    </div>

    <!-- Admin Panel (Shao Ziyue) -->
    <div id="admin-panel" class="step-container hidden">
      <div class="centered-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <h1 class="step-title" id="admin-title" style="margin: 0;">所有朋友</h1>
          <div>
            <button id="user-directory-btn" class="btn-secondary" style="margin-right: 8px;">🔑 用户</button>
            <button id="logout-btn" class="btn-secondary">登出</button>
          </div>
        </div>
        <div id="sessions-list" class="sessions-list"></div>
        <div class="create-session-form">
          <h3 id="create-session-title">与朋友创建会话</h3>
          <form id="create-session-form" class="clean-form">
            <div class="form-row">
              <input type="text" id="friend-family-name" placeholder="朋友的姓">
              <input type="text" id="friend-given-name" placeholder="朋友的名">
            </div>
            <button type="submit" class="btn btn-primary btn-large" id="create-session-btn">创建</button>
          </form>
        </div>
      </div>
    </div>

    <!-- User Directory (Admin Only) -->
    <div id="user-directory-panel" class="step-container hidden">
      <div class="centered-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <h1 class="step-title" style="margin: 0;">🔑 用户目录</h1>
          <div>
            <button id="back-to-admin-btn" class="btn-secondary" style="margin-right: 8px;">← 返回</button>
            <button id="logout-btn-directory" class="btn-secondary">登出</button>
          </div>
        </div>
        <div id="users-list" class="users-list"></div>
      </div>
    </div>

    <!-- Friend: My Sessions Panel -->
    <div id="friend-session-step" class="step-container hidden">
      <div class="centered-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <h1 class="step-title" id="friend-session-title" style="margin: 0;">来到这一步了</h1>
          <button id="logout-btn-friend" class="btn-secondary">登出</button>
        </div>
        
        <!-- Sessions List -->
        <div id="friend-sessions-list" class="sessions-list"></div>
        
        <!-- Create New Session Button -->
        <div style="text-align: center; margin-top: 32px;">
          <button id="create-new-session-btn" class="btn btn-primary btn-large">
            ✨ 开始与邵子越的对话，嘿嘿
          </button>
        </div>
      </div>
    </div>

    <!-- Message Input Interface (Page A) -->
    <div id="message-input-step" class="step-container hidden">
      <div class="centered-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
          <button id="back-to-panel-btn" class="btn-back">← 返回</button>
          <button id="logout-btn-message" class="btn-secondary">登出</button>
        </div>
        <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 16px;">
          <span style="font-size: 36px;">✍️</span>
          <h1 class="step-title" id="input-title" style="margin: 0;">到你下笔了</h1>
        </div>
        <p class="step-subtitle">好话限定😤</p>
        <div style="height: 2px; background: linear-gradient(90deg, transparent, var(--accent-2), transparent); margin: 24px 0;"></div>
        <form id="message-form" class="clean-form">
          <textarea id="message-text" placeholder="点击这里开写！" rows="6" required></textarea>
          <button type="submit" class="btn btn-primary btn-large" id="submit-message-btn">
            <span class="btn-text">写完发送！ →</span>
            <span class="btn-loading hidden">⏳</span>
          </button>
        </form>
      </div>
    </div>

    <!-- Loading Transition -->
    <div id="loading-step" class="step-container hidden">
      <div class="centered-card loading-card">
        <div class="spinner"></div>
        <p class="loading-text">处理中...</p>
      </div>
    </div>

    <!-- Success Celebration (First Session) -->
    <div id="success-step" class="step-container hidden">
      <div class="centered-card success-card">
        <h1 class="step-title">哦耶！</h1>
        <p class="success-message">与<strong><span id="success-friend-name"></span></strong>的会话已创建！</p>
        <div class="success-details">
          <p><strong>📝 会话ID：</strong> <span id="success-session-id"></span></p>
          <p class="success-note">分享此会话ID给您的朋友以便加入！</p>
        </div>
        <div class="success-actions">
          <button id="goto-session-btn" class="btn btn-primary btn-large">进入会话</button>
          <button id="back-to-dashboard-btn" class="btn-secondary">返回面板</button>
        </div>
      </div>
    </div>

    <!-- Status Interface (Waiting Room) -->
    <div id="status-step" class="step-container hidden">
      <div class="centered-card status-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <button id="view-all-sessions-btn" class="btn-back">← 返回</button>
          <button id="logout-btn-status" class="btn-secondary">登出</button>
        </div>
        <h1 class="step-title">等待室</h1>
        
        <div class="status-dashboard">
          <!-- My Status -->
          <div class="status-indicator" id="my-status">
            <div class="status-icon">
              <div class="status-checkmark hidden">✓</div>
              <div class="status-pulse"></div>
            </div>
            <div class="status-info">
              <h3 id="my-status-title">我</h3>
              <p class="status-text" id="my-status-text">⏳ 等待中...</p>
            </div>
          </div>

          <!-- Their Status -->
          <div class="status-indicator" id="their-status">
            <div class="status-icon">
              <div class="status-checkmark hidden">✓</div>
              <div class="status-pulse"></div>
            </div>
            <div class="status-info">
              <h3 id="their-status-title">朋友</h3>
              <p class="status-text" id="their-status-text">⏳ 等待中...</p>
            </div>
          </div>
        </div>

        <!-- Messages Display (Blurred until unlocked) -->
        <div id="messages-display" class="messages-container blurred">
          <div id="message-display-content"></div>
          <div class="blur-overlay">
            <p class="blur-text">需要双方消息才能解锁</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/script.js?v=2"></script>
</body>
</html>
